<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="layout/body">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
</head>
<body>
<section layout:fragment="content">
    <div class="container-fluid">
        <form id="form-query" th:action="@{/dbm/admin}"
              th:object="${sqlQueryVO}" method="post"
              onsubmit="return checkFrom()">
            <div class="panel">
                <div class="panel-heading">
                    <h3 class="panel-title searchCondition">操作条件</h3>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-sm-3 stepWord">
                            <span class="form_search_height color-gray">请选择要操作的表</span>
                            <select id="tableName" class="selectpicker color-gray" data-live-search="true">
                                <option th:value="--">请选择</option>
                            </select>
                        </div>

                        <div class="col-sm-3 stepWord">
                            <span class="form_search_height color-gray" >选择操作类型</span>
                            <select id="sqlType" class="form_search_height color-gray" th:field="*{sqlType}">
                                <option th:value="SELECT">查询</option>
                                <option th:value="UPDATE">更新</option>
                                <option th:value="INSERT">插入</option>
                                <option th:value="DELETE">删除</option>
                            </select>
                        </div>

                        <button class="btn btn-primary form_search_height btn2"
                                type="button" onclick="confirm_type()">确定
                        </button>
                    </div>


                    <span class="searchResult">操作字段</span>
                    <hr/>


                </div>
            </div>
        </form>
    </div>
    <link rel="stylesheet" th:href="@{/css/bootstrap-select.min.css}" />
    <script th:src="@{/js/bootstrap-select.min.js}"></script>
    <script th:src="@{/js/select2.js}"></script>
    <script src="https://cdn.bootcss.com/select2/4.0.6-rc.1/js/i18n/zh-CN.js"></script>
    <script th:inline="javascript">
        /*<![CDATA[*/
        $(function () {
            //请求所有的表
            $.ajax({
                type : "POST",
                url : "/table/all-tables",
                dataType : 'json',
                success : function(data) {
                    if (data.code == "200") {
                        var tableList = data.dataMap;
                        for (var i = 0; i < tableList.length; i++) {
                            var tableName = tableList[i];
                            var html = $('<option value="' + tableName + '">' + tableName + '</option>');
                            $('#tableName').append(html);
                        }
                        $('#tableName').selectpicker('refresh');
                        $('#tableName').selectpicker('show');
                    } else {
                        alert(data.message);
                    }
                },
                error : function(
                    XMLHttpRequest,
                    textStatus, errorThrown) {
                    alert("请求错误！");
                }
            });
        });

        //确定按钮
        function confirm_type(){
            var tableName = $("#tableName option:selected").val();
            var sqlType = $("#sqlType option:selected").val();
            if(tableName == "--"){
                alert("请选择要操作的表！");
                return;
            }
            $.ajax({
                type : "POST",
                url : "/dbm/confirm",
                data:{
                    tableName: tableName,
                    sqlType: sqlType
                },
                dataType : 'json',
                success : function(data) {
                    if (data.code == "200") {
                        var columnList = data.dataMap;

                    } else {
                        alert(data.message);
                    }
                },
                error : function(
                    XMLHttpRequest,
                    textStatus, errorThrown) {
                    alert("请求错误！");
                }
            });

        }
        /*]]>*/
    </script>
</section>
</body>
</html>